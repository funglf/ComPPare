\doxysection{examples/saxpy Directory Reference}
\hypertarget{dir_43f74b311631c0ae28958e88878cbbc9}{}\label{dir_43f74b311631c0ae28958e88878cbbc9}\index{examples/saxpy Directory Reference@{examples/saxpy Directory Reference}}
Directory dependency graph for saxpy\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=224pt]{dir_43f74b311631c0ae28958e88878cbbc9_dep}
\end{center}
\end{figure}
\doxysubsubsection*{Directories}
\begin{DoxyCompactItemize}
\item 
directory \mbox{\hyperlink{dir_663d2cb02491de88aef47a0aeebe2300}{build}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Files}
\begin{DoxyCompactItemize}
\item 
file \mbox{\hyperlink{saxpy_2init__saxpy_8cpp}{init\+\_\+saxpy.\+cpp}}
\item 
file \mbox{\hyperlink{saxpy_2init__saxpy_8hpp}{init\+\_\+saxpy.\+hpp}}
\item 
file \mbox{\hyperlink{saxpy_2main_8cpp}{main.\+cpp}}
\item 
file \mbox{\hyperlink{saxpy_2saxpy__cpu_8cpp}{saxpy\+\_\+cpu.\+cpp}}
\item 
file \mbox{\hyperlink{saxpy_2saxpy__cpu_8hpp}{saxpy\+\_\+cpu.\+hpp}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\doxysubsection*{SAXPY}

{\bfseries{SAXPY}} stands for {\bfseries{Single-\/\+Precision A·X Plus Y}}. ~\newline
 It computes the vector operation\+:

\$\$ y\+\_\+\{\textbackslash{}text\{out\}\}\mbox{[}i\mbox{]} = a \textbackslash{}cdot x\mbox{[}i\mbox{]} + y\mbox{[}i\mbox{]} \$\$

where\+:
\begin{DoxyItemize}
\item {\ttfamily x}, {\ttfamily y} are input vectors (length N)
\item {\ttfamily a} is a scalar constant
\item {\ttfamily y\+\_\+out} is the result vector
\end{DoxyItemize}

\DoxyHorRuler{0}


\doxysubsection*{Build Instructions}

\doxysubsubsection*{Dependencies}


\begin{DoxyItemize}
\item CMake
\item C++20 compatible compiler
\item For GPU kernel build\+:
\begin{DoxyItemize}
\item NVIDIA nvcc compiler wrapper
\end{DoxyItemize}
\end{DoxyItemize}

\DoxyHorRuler{0}


\doxysubsubsection*{GPU Build}


\begin{DoxyCode}{0}
\DoxyCodeLine{mkdir\ build\ \&\&\ cd\ build}
\DoxyCodeLine{}
\DoxyCodeLine{cmake\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCMAKE\_BUILD\_TYPE=Release\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCMAKE\_CXX\_COMPILER=g++\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCMAKE\_CUDA\_HOST\_COMPILER=g++\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DUSE\_CUDA=ON\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ ..}
\DoxyCodeLine{}
\DoxyCodeLine{make}

\end{DoxyCode}


\doxysubsubsubsection*{Optional GPU build option}


\begin{DoxyCode}{0}
\DoxyCodeLine{cmake\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCMAKE\_BUILD\_TYPE=Release\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCMAKE\_CXX\_COMPILER=g++\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCMAKE\_CUDA\_HOST\_COMPILER=g++\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DUSE\_CUDA=ON\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCUDA\_ARCH=90\ \(\backslash\)\ \#Optional:\ Specify\ CUDA\ Architecture\ }
\DoxyCodeLine{\ \ \ \ ..}

\end{DoxyCode}


\doxysubsubsection*{CPU only Build (default)}


\begin{DoxyCode}{0}
\DoxyCodeLine{mkdir\ build\ \&\&\ cd\ build}
\DoxyCodeLine{cmake\ ..}
\DoxyCodeLine{make}

\end{DoxyCode}


Or explicitly\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{mkdir\ build\ \&\&\ cd\ build}
\DoxyCodeLine{}
\DoxyCodeLine{cmake\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCMAKE\_BUILD\_TYPE=Release\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCMAKE\_CXX\_COMPILER=g++\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DUSE\_CUDA=OFF\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ ..}
\DoxyCodeLine{}
\DoxyCodeLine{make}

\end{DoxyCode}


Only CPU backends (scalar and parallel) will be built.

\DoxyHorRuler{0}


\doxysubsection*{Run the Benchmark}

The executable takes the following command-\/line arguments\+:

\doxysubsubsection*{Arguments}

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Flag  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Description  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Default  }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Flag  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Description  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Default  }\\\cline{1-3}
\endhead
{\ttfamily -\/-\/size}  &log2 of vector size ({\ttfamily N = 2\texorpdfstring{$^\wedge$}{\string^}n})  &10  \\\cline{1-3}
{\ttfamily -\/-\/scalar}  &scalar multiplier {\ttfamily a}  &random \mbox{[}-\/5, 5\mbox{]}  \\\cline{1-3}
\end{longtabu}


\doxysubsubsection*{Example}


\begin{DoxyCode}{0}
\DoxyCodeLine{./saxpy\ -\/-\/size\ 27\ -\/-\/scalar\ 10.98}

\end{DoxyCode}


\doxysubsubsection*{Output Example}

Output will print\+:


\begin{DoxyItemize}
\item Function execution time
\item Core compute time (isolated)
\item Overhead (e.\+g., memory copies)
\item Correctness metrics\+: max, mean, total error
\end{DoxyItemize}

\DoxyHorRuler{0}



\begin{DoxyCode}{0}
\DoxyCodeLine{===\ SAXPY\ Benchmark\ Parameters\ ===}
\DoxyCodeLine{Vector\ size\ (N)\ \ \ \ \ :\ 1024}
\DoxyCodeLine{Scalar\ a\ \ \ \ \ \ \ \ \ \ \ \ :\ 4.30614}
\DoxyCodeLine{===================================}
\DoxyCodeLine{}
\DoxyCodeLine{*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=}
\DoxyCodeLine{============\ ComPPare\ Framework\ ============}
\DoxyCodeLine{=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*}
\DoxyCodeLine{}
\DoxyCodeLine{Number\ of\ implementations:\ \ \ \ \ \ \ \ \ \ \ \ \ 3}
\DoxyCodeLine{Warmup\ iterations:\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 100}
\DoxyCodeLine{Benchmark\ iterations:\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 100}
\DoxyCodeLine{=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*}
\DoxyCodeLine{}
\DoxyCodeLine{Implementation\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Func\ µs\ \ \ \ \ \ \ \ \ \ \ \ \ ROI\ µs\ \ \ \ \ \ \ \ \ \ \ \ Ovhd\ µs\ \ \ \ \ \ \ \ \ Max|err|[0]\ \ \ \ \ \ \ \ Mean|err|[0]\ \ \ \ \ \ \ Total|err|[0]}
\DoxyCodeLine{cpu\ serial\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 38.01\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 15.97\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 22.05\ \ \ \ \ \ \ \ \ \ \ \ 0.00e+00\ \ \ \ \ \ \ \ \ \ \ \ 0.00e+00\ \ \ \ \ \ \ \ \ \ \ \ 0.00e+00}
\DoxyCodeLine{cpu\ parallel\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 48098.13\ \ \ \ \ \ \ \ \ \ \ \ 17477.30\ \ \ \ \ \ \ \ \ \ \ \ 30620.83\ \ \ \ \ \ \ \ \ \ \ \ 0.00e+00\ \ \ \ \ \ \ \ \ \ \ \ 0.00e+00\ \ \ \ \ \ \ \ \ \ \ \ 0.00e+00}
\DoxyCodeLine{gpu\ kernel\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 73151.41\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 1.07\ \ \ \ \ \ \ \ \ \ \ \ 73150.34\ \ \ \ \ \ \ \ \ \ \ \ 3.30e+06\ \ \ \ \ \ \ \ \ \ \ \ 1.66e+06\ \ \ \ \ \ \ \ \ \ \ \ 1.70e+09\ \ <-\/-\/\ FAIL}

\end{DoxyCode}


\begin{quote}
Note\+: The gpu kernel example in saxpy\+\_\+gpu.\+cu deliberately contains a bug that causes the validation to fail (\texorpdfstring{$<$}{<}-- FAIL). You’ll need to debug and correct the GPU implementation in {\ttfamily saxpy\+\_\+gpu.\+cu} \end{quote}


\doxysubsection*{Implementation of Com\+PPare in this example}

\doxysubsubsection*{Basic Usage of {\ttfamily HOTLOOP} Macro}

Adding {\ttfamily HOTLOOPSTART} and {\ttfamily HOTLOOPEND} macros to the region you want to benchmark. It will run the region with certain iterations of warmup (default=100) before running another certain number of iterations for benchmark (default=100).


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ saxpy\_cpu.cpp}}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ \mbox{\hyperlink{saxpy_2saxpy__cpu_8cpp_a8672c519498ebe4b5f93ebee3adb4e87}{cpu\_std}}(\textcolor{keywordtype}{float}\ a,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<float>\ \&x,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<float>\ \&y\_in,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<float>\ \&y\_out)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{manual__timing__demo_8cpp_a0240ac851181b84ac374872dc5434ee4}{N}}\ =\ x.size();}
\DoxyCodeLine{\ \ \ \ y\_out.resize(\mbox{\hyperlink{manual__timing__demo_8cpp_a0240ac851181b84ac374872dc5434ee4}{N}});}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{comppare_8hpp_a03adebee29527207e43a1b362d77fe65}{HOTLOOPSTART}};\ \ \ \textcolor{comment}{//\ Start\ of\ Region\ you\ want\ to\ benchmark}}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{manual__timing__demo_8cpp_a0240ac851181b84ac374872dc5434ee4}{N}};\ ++i)}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ y\_out[i]\ =\ a\ *\ x[i]\ +\ y\_in[i];}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{comppare_8hpp_a3f983d0c821f40a98683debcc90a1e97}{HOTLOOPEND}};\ \ \ \ \ \textcolor{comment}{//\ End\ of\ Region\ you\ want\ to\ benchmark}}
\DoxyCodeLine{\}}

\end{DoxyCode}


\doxysubsubsection*{{\ttfamily HOTLOOP} Macro for GPU}

{\ttfamily HOTLOOP} macro for gpu (CUDA/\+HIP) uses the {\ttfamily GPU\+\_\+\+HOTLOOPSTART} and {\ttfamily GPU\+\_\+\+GPU\+\_\+\+HOTLOOPEND} macros as they use \href{https://docs.nvidia.com/cuda/cuda-runtime-api/group__CUDART__EVENT.html\#group__CUDART__EVENT_1g949aa42b30ae9e622f6ba0787129ff22}{\texttt{cuda\+Event\+Synchronize()}}/\href{https://rocm.docs.amd.com/projects/HIP/en/develop/doxygen/html/group___event.html\#ga1f72d98ba5d6f7dc3da54e0c41fe38b1}{\texttt{hip\+Event\+Synchronize()}} to time the completion of kernels on device. ~\newline



\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ saxpy\_gpu.cu}}
\DoxyCodeLine{\textcolor{keywordtype}{void}\ gpu\_std(\textcolor{keywordtype}{float}\ a,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<float>\ \&x,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::vector<float>\ \&y\_in,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ std::vector<float>\ \&y\_out)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ ...}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ GPU\_HOTLOOPSTART;\ \ \ \textcolor{comment}{//\ Start\ of\ Region\ you\ want\ to\ benchmark}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ saxpy\_kernel<<<grid,\ block>>>(a,\ d\_x,\ d\_y\_in,\ d\_y\_out,\ \mbox{\hyperlink{manual__timing__demo_8cpp_a0240ac851181b84ac374872dc5434ee4}{N}});}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ GPU\_HOTLOOPEND;\ \ \ \ \ \textcolor{comment}{//\ End\ of\ Region\ you\ want\ to\ benchmark}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ ...}
\DoxyCodeLine{\}}

\end{DoxyCode}
 
