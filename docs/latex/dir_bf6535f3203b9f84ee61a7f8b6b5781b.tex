\doxysection{examples/saxpy\+\_\+googlebench Directory Reference}
\hypertarget{dir_bf6535f3203b9f84ee61a7f8b6b5781b}{}\label{dir_bf6535f3203b9f84ee61a7f8b6b5781b}\index{examples/saxpy\_googlebench Directory Reference@{examples/saxpy\_googlebench Directory Reference}}
Directory dependency graph for saxpy\+\_\+googlebench\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=284pt]{dir_bf6535f3203b9f84ee61a7f8b6b5781b_dep}
\end{center}
\end{figure}
\doxysubsubsection*{Directories}
\begin{DoxyCompactItemize}
\item 
directory \mbox{\hyperlink{dir_838efd0a3f64e923e8ae04ffbd0e2d17}{build}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Files}
\begin{DoxyCompactItemize}
\item 
file \mbox{\hyperlink{saxpy__googlebench_2init__saxpy_8cpp}{init\+\_\+saxpy.\+cpp}}
\item 
file \mbox{\hyperlink{saxpy__googlebench_2init__saxpy_8hpp}{init\+\_\+saxpy.\+hpp}}
\item 
file \mbox{\hyperlink{saxpy__googlebench_2main_8cpp}{main.\+cpp}}
\item 
file \mbox{\hyperlink{saxpy__googlebench_2saxpy__cpu_8cpp}{saxpy\+\_\+cpu.\+cpp}}
\item 
file \mbox{\hyperlink{saxpy__googlebench_2saxpy__cpu_8hpp}{saxpy\+\_\+cpu.\+hpp}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\doxysubsection*{SAXPY}

{\bfseries{SAXPY}} stands for {\bfseries{Single-\/\+Precision A·X Plus Y}}. ~\newline
 It computes the vector operation\+:

\$\$ y\+\_\+\{\textbackslash{}text\{out\}\}\mbox{[}i\mbox{]} = a \textbackslash{}cdot x\mbox{[}i\mbox{]} + y\mbox{[}i\mbox{]} \$\$

where\+:
\begin{DoxyItemize}
\item {\ttfamily x}, {\ttfamily y} are input vectors (length N)
\item {\ttfamily a} is a scalar constant
\item {\ttfamily y\+\_\+out} is the result vector
\end{DoxyItemize}

\DoxyHorRuler{0}


\doxysubsection*{Build Instructions}

\doxysubsubsection*{Dependencies}


\begin{DoxyItemize}
\item CMake
\item C++20 compatible compiler
\item For GPU kernel build\+:
\begin{DoxyItemize}
\item NVIDIA nvcc compiler wrapper
\end{DoxyItemize}
\item For C++ stdpar on GPU builds\+:
\begin{DoxyItemize}
\item NVIDIA HPC SDK with {\ttfamily nvc++}
\end{DoxyItemize}
\end{DoxyItemize}

\DoxyHorRuler{0}


\doxysubsubsection*{GPU Build (with nvc++, stdpar on gpu, CUDA kernel)}


\begin{DoxyCode}{0}
\DoxyCodeLine{mkdir\ build\ \&\&\ cd\ build}
\DoxyCodeLine{}
\DoxyCodeLine{cmake\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCMAKE\_BUILD\_TYPE=Release\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCMAKE\_CXX\_COMPILER=nvc++\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCMAKE\_CUDA\_HOST\_COMPILER=nvc++\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCUDA=ON\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCUDA\_ARCH=70\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ ..}
\DoxyCodeLine{}
\DoxyCodeLine{make}
\DoxyCodeLine{\`{}\`{}\`{}\`{}}
\DoxyCodeLine{}
\DoxyCodeLine{\#\#\#\ GPU\ Build\ (with\ g++,\ CUDA\ kernel)}

\end{DoxyCode}
 bash mkdir build \&\& cd build

cmake \textbackslash{} -\/DCMAKE\+\_\+\+BUILD\+\_\+\+TYPE=Release \textbackslash{} -\/DCMAKE\+\_\+\+CXX\+\_\+\+COMPILER=g++ \textbackslash{} -\/DCMAKE\+\_\+\+CUDA\+\_\+\+HOST\+\_\+\+COMPILER=g++ \textbackslash{} -\/DCUDA=ON \textbackslash{} -\/DCUDA\+\_\+\+ARCH=70 \textbackslash{} ..

make \`{}\`{}\`{}\`{}

\doxysubsubsection*{CPU only Build (default)}


\begin{DoxyCode}{0}
\DoxyCodeLine{mkdir\ build\ \&\&\ cd\ build}
\DoxyCodeLine{cmake\ ..}
\DoxyCodeLine{make}

\end{DoxyCode}


Or explicitly\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{mkdir\ build\ \&\&\ cd\ build}
\DoxyCodeLine{}
\DoxyCodeLine{cmake\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCMAKE\_BUILD\_TYPE=Release\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCMAKE\_CXX\_COMPILER=g++\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ -\/DCUDA=OFF\ \(\backslash\)}
\DoxyCodeLine{\ \ \ \ ..}
\DoxyCodeLine{}
\DoxyCodeLine{make}

\end{DoxyCode}


Only CPU backends (scalar and parallel) will be built.

\DoxyHorRuler{0}


\doxysubsection*{Run the Benchmark}

The executable takes the following command-\/line arguments\+:

\doxysubsubsection*{Arguments}

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Flag  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Description  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Default  }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Flag  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Description  }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Default  }\\\cline{1-3}
\endhead
{\ttfamily -\/-\/size}  &log2 of vector size ({\ttfamily N = 2\texorpdfstring{$^\wedge$}{\string^}n})  &26  \\\cline{1-3}
{\ttfamily -\/-\/scalar}  &scalar multiplier {\ttfamily a}  &random \mbox{[}-\/5, 5\mbox{]}  \\\cline{1-3}
{\ttfamily -\/-\/iter}  &number of benchmark iterations  &10  \\\cline{1-3}
{\ttfamily -\/-\/tol}  &numerical tolerance for validation  &1e-\/6  \\\cline{1-3}
{\ttfamily -\/-\/warmup/-\/-\/no-\/warmup}  &to do warmup run or not  &warmup  \\\cline{1-3}
\end{longtabu}


\doxysubsubsection*{Example}


\begin{DoxyCode}{0}
\DoxyCodeLine{./saxpy\ -\/-\/size\ 27\ -\/-\/scalar\ 10.98\ -\/-\/iter\ 100\ -\/-\/tol\ 1e-\/8}

\end{DoxyCode}


\doxysubsubsection*{Output Example}

Output will print\+:


\begin{DoxyItemize}
\item Function execution time
\item Core compute time (isolated)
\item Overhead (e.\+g., memory copies)
\item Validation metrics\+: max, mean, total error
\item if max error \texorpdfstring{$>$}{>} tolerance -\/-\/\texorpdfstring{$>$}{>} index of the max error (where)
\end{DoxyItemize}

\DoxyHorRuler{0}



\begin{DoxyCode}{0}
\DoxyCodeLine{===\ SAXPY\ Benchmark\ Parameters\ ===}
\DoxyCodeLine{Vector\ size\ (N)\ \ \ \ \ :\ 134217728}
\DoxyCodeLine{Scalar\ a\ \ \ \ \ \ \ \ \ \ \ \ :\ 10.98}
\DoxyCodeLine{Iterations\ \ \ \ \ \ \ \ \ \ :\ 100}
\DoxyCodeLine{Error\ tolerance\ \ \ \ \ :\ 1e-\/08}
\DoxyCodeLine{===================================}
\DoxyCodeLine{}
\DoxyCodeLine{Name\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Func\ µs\ \ \ \ \ \ \ \ \ \ Core\ µs\ \ \ \ \ \ \ \ \ \ Ovhd\ µs\ \ \ \ \ \ \ Max|err|[0]\ \ \ \ \ \ (MaxErr-\/idx)\ \ \ \ \ \ Mean|err|[0]\ \ \ \ \ Total|err|[0]}
\DoxyCodeLine{cpu\ serial\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 134034.89\ \ \ \ \ \ \ \ \ 132343.70\ \ \ \ \ \ \ \ \ \ \ 1691.18\ \ \ \ \ \ \ \ \ \ 0.00e+00\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ —\ \ \ \ \ \ \ \ \ \ 0.00e+00\ \ \ \ \ \ \ \ \ \ 0.00e+00}
\DoxyCodeLine{cpu\ parallel\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 29604.00\ \ \ \ \ \ \ \ \ \ 27894.86\ \ \ \ \ \ \ \ \ \ \ 1709.14\ \ \ \ \ \ \ \ \ \ 0.00e+00\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ —\ \ \ \ \ \ \ \ \ \ 0.00e+00\ \ \ \ \ \ \ \ \ \ 0.00e+00}
\DoxyCodeLine{gpu\ std\ par\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 4489.56\ \ \ \ \ \ \ \ \ \ \ 2774.86\ \ \ \ \ \ \ \ \ \ \ 1714.70\ \ \ \ \ \ \ \ \ \ 0.00e+00\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ —\ \ \ \ \ \ \ \ \ \ 0.00e+00\ \ \ \ \ \ \ \ \ \ 0.00e+00}
\DoxyCodeLine{gpu\ kernel\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 6943.10\ \ \ \ \ \ \ \ \ \ \ 1936.11\ \ \ \ \ \ \ \ \ \ \ 5006.99\ \ \ \ \ \ \ \ \ \ 1.10e+13\ \ \ \ \ \ \ \ \ \ \ 5254268\ \ \ \ \ \ \ \ \ \ 2.74e+12\ \ \ \ \ \ \ \ \ \ 3.68e+20\ \ <-\/-\/\ FAIL}

\end{DoxyCode}


\begin{quote}
Note\+: The gpu kernel example in saxpy\+\_\+gpu.\+cu deliberately contains a bug that causes the validation to fail (\texorpdfstring{$<$}{<}-- FAIL). You’ll need to debug and correct the GPU implementation in {\ttfamily saxpy\+\_\+gpu.\+cu} \end{quote}
